<div class="ui-g ui-g-nopad mainHeader">
  <div class="ui-g-12 ui-md-10 ui-lg-10 ui-g-nopad" style="padding: 5px 5px 5px 10px">
    Employee Utilization Report <i class="fa fa-question-circle fa-5x" pTooltip="Get Help" style="cursor:help; font-size: 25px; color: orange; vertical-align: middle;padding-bottom: 5px"
      (click)="showHelp('EmployeeUtilizationReport.htm')"></i>
  </div>
  <div class="ui-g-3 ui-md-2 ui-g-nopad">
    <div class="ui-g-3 ui-md-6"></div>
    <div class="ui-g-3 ui-md-4"></div>
    <div class="ui-g-6 ui-md-2 ui-g-nopad">
      <!-- <a (click)="showHelp('EmployeesByBillingCode.htm')" style="cursor: help;"><i class="fa fa-question fa-150x" style="padding-top:2px; color:black"></i></a> -->
    </div>
  </div>
</div>
<br>
<p-panel [toggleable]="true" header="Filter results by:" *ngIf="showFilters">
  <div class="ui-g">
    <div class="ui-g-12 ui-md-3">
      <label class="label" style="padding:0px 10px;">Select Department:</label>
      <p-dropdown [options]="_Departments" [(ngModel)]="_selectedDepartment" optionLabel="Name" pTooltip="Employee's Department"
        tooltipPosition="bottom" [style]="{'width':'300px;'}"></p-dropdown>
    </div>
  </div>
  <p-footer>
    <div style="text-align: right">
      <button pButton pTooltip="Show the employees that match your choices" tooltipPosition="bottom" class="ui-button-info"
        label="Show Employees" (click)=showEmployees()></button>
    </div>
  </p-footer>
</p-panel>

<div class="ui-g" *ngIf="showDepartmentName">
  <div class="ui-g-12 ui-md-2" style="text-align: left;">
    <ng-container *ngIf="_selectedDepartment !== undefined && _selectedDepartment !== null">
      Department : {{_selectedDepartment.Name}}
    </ng-container>
  </div>
  <div class="ui-g-12 ui-md-6" style="text-align: left;">
    <ng-container *ngIf="showDateRangeValues && _startDateVal && _endDateVal">
      Date Range From: {{_startDateVal}} <label class="label" style="padding:0px 10px">to</label> {{_endDateVal}}
    </ng-container>
  </div>
  <div class="ui-g-12 ui-md-4" align="right">
    <ng-container *ngIf="showDateRangeValues">
      <button pButton pTooltip="Change your report selection criteria" tooltipPosition="bottom" class="ui-button-warning"
        label="Start Over" (click)=startOver()></button>
    </ng-container>
  </div>
</div>

<div class="ui-g  ui-g-nopad">
  <div class="ui-g-6 ui-md-12">
    <p-checkbox *ngIf="showSelectList" binary="true" label="Select/Clear All" [(ngModel)]="allcheckbox" (onChange)="selectAll()"></p-checkbox>
  </div>
</div>
<div *ngIf="showSelectList">
  <p-panel class="panelEmpBilling">
    <p-header>
      <h3 class="first">{{_selectString}}</h3>
    </p-header>
    <p-scrollPanel [style]="{height: '400px'}">
      <div class="ui-g" style="margin-bottom:10px">
        <div class="ui-g-4" *ngFor="let _dcb of _displayCheckBoxes">
          <p-checkbox name="showBillingDetails" [value]="_dcb.value" pTooltip="Select the billing codes to appear in the report"
            tooltipPosition="bottom" [label]="_dcb.label" [(ngModel)]="_selectcheckbox" (click)="selectcheck()"></p-checkbox>
        </div>
      </div>
    </p-scrollPanel>
    <p-footer>
      <h3 class="first">{{_selectcheckbox.length}} record(s) selected</h3>
    </p-footer>
  </p-panel>
</div>

<div class="ui-g" style="padding-top: 5px;border: solid 1px #b3b3b3;" *ngIf="showSelectList">
  <div class="ui-g-12 ui-md-6">
    Date Range From:
    <p-calendar appendTo="body" [readonlyInput]="true" dateFormat="mm-dd-yy" pTooltip="Enter a starting date or leave blank to select from the earliest date. Invalid entries will be reset"
      tooltipPosition="bottom" [monthNavigator]="true" showButtonBar="true" [yearNavigator]="true" yearRange="1900:2100"
      [(ngModel)]="_startDate" [inputStyle]="{'width':'100px'}" [maxDate]="_todayDate"></p-calendar>
    <!-- [disabledDays]="[1,2,3,4,5,6]" -->
    <label class="label" style="padding:0px 10px">to</label>
    <p-calendar appendTo="body" [readonlyInput]="true" dateFormat="mm-dd-yy" pTooltip="Enter the end date or leave blank to select up to the current date. Invalid entries will be reset"
      tooltipPosition="bottom" [monthNavigator]="true" showButtonBar="true" [yearNavigator]="true" yearRange="1900:2100"
      [(ngModel)]="_endDate" [inputStyle]="{'width':'100px'}" [minDate]="_startDate"></p-calendar>
    <!-- [disabledDays]="[0,1,2,3,4,5]" -->
    <!-- [maxDate]="_todayDate" -->
  </div>
  <div class="ui-g-12 ui-md-6" align="right">
    <button pButton pTooltip="Run the report" tooltipPosition="bottom" class="ui-button-info" label="Generate Report"
      [disabled]="!(this._selectcheckbox.length>0) || !(_startDate !== '' && _endDate !== '' && (_startDate <= _endDate))"
      (click)=generateReport()></button>
    &nbsp; &nbsp; &nbsp;
    <button pButton pTooltip="Change your report selection criteria" tooltipPosition="bottom" class="ui-button-warning"
      label="Start Over" (click)=startOver()></button>
  </div>
</div>


<div class="ui-g-12" *ngIf="_UtilizationReportDetails !== undefined && _UtilizationReportDetails !== null">
  <p-scrollPanel [style]="{height: '400px'}">
    <div style="width:100%;">
      <table cellpadding="0" cellspacing="0" width="100%" style="padding-right:20px;" class="ui-table" *ngIf="_UtilizationReportDetails.WeekNumDetails !== undefined && _UtilizationReportDetails.WeekNumDetails !== null && _UtilizationReportDetails.WeekNumDetails.length > 0">
        <thead class="ui-table-thead">
          <tr>
            <th class="tdName" style="border:0px;">&nbsp;</th>
            <th [ngStyle]="getDisplayColors(i,1)" *ngFor="let weekNumDetails of _UtilizationReportDetails.WeekNumDetails;index as i"
              colspan="5">
              {{weekNumDetails.Startdate}}<br> {{weekNumDetails.Enddate}}
            </th>
          </tr>
          <tr class="trHeader">
            <th>Employee</th>
            <ng-container *ngFor="let weekNumDetails of _UtilizationReportDetails.WeekNumDetails;index as i">
              <th>
                Utilization
              </th>
              <th>
                Weekday
              </th>
              <th>
                Holiday
              </th>
              <th>
                PTO
              </th>
              <th>
                Billable
              </th>
            </ng-container>
          </tr>
        </thead>
        <tbody class="ui-table-tbody">
          <tr *ngFor="let distinctEmployees of _DistinctEmployee">
            <td class="tdName" style="border:0px;">
              {{distinctEmployees.Name}}
            </td>
            <ng-container *ngFor="let weekNumDetails of _UtilizationReportDetails.WeekNumDetails;index as i">
              <ng-container *ngFor="let EmployeeLevelDetails of _UtilizationReportDetails.EmployeeLevelDetails">
                <ng-container *ngIf="EmployeeLevelDetails.Name === distinctEmployees.Name && EmployeeLevelDetails.WeekNum === weekNumDetails.WeekNum">
                  <td class="tdValues" [ngStyle]="getDisplayColors(i,0)">
                    {{ EmployeeLevelDetails.Utilization}}%
                  </td>
                  <td class="tdValues" [ngStyle]="getDisplayColors(i,0)">
                    {{ ((EmployeeLevelDetails.Weekday > 0) ? EmployeeLevelDetails.Weekday : '-') }}
                  </td>
                  <td class="tdValues" [ngStyle]="getDisplayColors(i,0)">
                    {{ ((EmployeeLevelDetails.Holiday > 0) ? EmployeeLevelDetails.Holiday : '-')}}
                  </td>
                  <td class="tdValues" [ngStyle]="getDisplayColors(i,0)">
                    {{ ((EmployeeLevelDetails.PTO > 0) ? EmployeeLevelDetails.PTO : '-')}}
                  </td>
                  <td class="tdValues" [ngStyle]="getDisplayColors(i,0)">
                    {{ ((EmployeeLevelDetails.Billable > 0) ? EmployeeLevelDetails.Billable : '-')}}
                  </td>
                </ng-container>
              </ng-container>
            </ng-container>
          </tr>
          <tr class="trSummary">
            <td class="tdName">Summary of Team</td>
            <ng-container *ngFor="let weekNumDetails of _UtilizationReportDetails.WeekNumDetails;index as i">
              <ng-container *ngFor="let TeamLevelDetails of _UtilizationReportDetails.TeamLevelDetails">
                <ng-container *ngIf="TeamLevelDetails.WeekNum === weekNumDetails.WeekNum">
                  <td class="tdValues">
                    {{ TeamLevelDetails.Utilization}}%
                  </td>
                  <td class="tdValues">
                    {{ ((TeamLevelDetails.Weekday > 0) ? TeamLevelDetails.Weekday : '-') }}
                  </td>
                  <td class="tdValues">
                    {{ ((TeamLevelDetails.Holiday > 0) ? TeamLevelDetails.Holiday : '-')}}
                  </td>
                  <td class="tdValues">
                    {{ ((TeamLevelDetails.PTO > 0) ? TeamLevelDetails.PTO : '-')}}
                  </td>
                  <td class="tdValues">
                    {{ ((TeamLevelDetails.Billable > 0) ? TeamLevelDetails.Billable : '-')}}
                  </td>
                </ng-container>
              </ng-container>
            </ng-container>
          </tr>
        </tbody>
      </table>
    </div>
  </p-scrollPanel>
</div>
<p-progressSpinner class="positionMiddle" *ngIf="showSpinner" [style]="{width: '50px', height: '50px'}" strokeWidth="4"
  fill="#EEEEEE"></p-progressSpinner>
<p-sidebar [(visible)]="visibleHelp" position="right" [baseZIndex]="10000" styleClass="ui-sidebar-md sidebarHelp">
  <p-scrollPanel [style]="{width: '100%', height: '100%'}">
    <div [innerHtml]="helpText" class="helpDisplayClass"></div>
  </p-scrollPanel>
</p-sidebar>
